#!/bin/sh
# Pre-commit hook: Run Biome checks on staged files

echo "Running Biome checks on staged files..."

# Run Biome check with auto-fix on staged files
bunx biome check --write --staged --no-errors-on-unmatched

# Capture exit code
BIOME_EXIT=$?

# If Biome made changes, re-stage the fixed files
if [ $BIOME_EXIT -eq 0 ]; then
  git diff --name-only --cached | xargs git add 2>/dev/null || true
  echo "✓ Biome checks passed"
elif [ $BIOME_EXIT -eq 1 ]; then
  echo "✗ Biome found errors that require manual fixes"
  echo "Run 'bunx biome check --write .' to see details"
  exit 1
fi

exit 0
